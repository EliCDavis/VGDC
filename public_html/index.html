<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>VGDC</title>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script src="js/libs/jquery/jquery.min.js"></script>

        <script src="js/libs/ko/knockout-3.3.0.js"></script>
        <script src="js/libs/bootstrap-3.3.5-dist/js/bootstrap.js"></script>
        <script src ="js/libs/github/github.js"></script>
        <script src="js/libs/showdown/showdown.min.js"></script>
        
        <link href="js/libs/bootstrap-3.3.5-dist/css/bootstrap.css" rel="stylesheet">
        
        <link href="js/libs/magic/magic.min.css" rel="stylesheet">
        
        <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192"  href="android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
        <link rel="manifest" href="manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">
        <link rel="shortcut icon" href="favicon.ico">

        <style>
            body {
                background-color: #323232
            }

            h1   {
                color:blue
            }


        </style>

    </head>

    <body>
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" data-bind="click: switchToFrontPage"><img alt="Brand" src="favicon.ico"></a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">

                        <li><a href="https://www.google.com/calendar/embed?src=01eeca7ap5jgqn2ihk7sas0dcc%40group.calendar.google.com&ctz=America/Chicago">Calender</a></li>
                        <li><a href="https://www.reddit.com/r/MSUVGDC/">Discussion</a></li>
                        <li><a href="http://www.videogamedev.club/owncloud">Resource Archive</a></li>
                        <li><a href="http://videogamedev.club/ChickenBuild/">Current Game Build</a></li>
                        <li><a data-bind="click: switchToPlans">Current Game Plans</a></li>

                    </ul>

                    <ul class="nav navbar-nav navbar-right">

                        <li><a href="javascript:$('#confirm-action').modal()"><b>Contact Us</b></a></li>
                        
                        <li>
                            <a href="https://github.com/EliCDavis/VGDC">
                                <img width="20" src="http://uxrepo.com/static/icon-sets/typicons/svg/github-circled.svg">
                            </a>
                        </li>

                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>

        <div class="container">

            <div class="row" data-bind="if: currentPageView() == 'Front'">
                <div class="col-md-8" id="announcements-panel">

                    
                    <div data-bind="if: viewType() == 'Jumbo'">
                    
                        <div class="jumbotron" >
                            <h1 data-bind='text: postDisplayedTitle'></h1>
                            <i><p data-bind="text: postDisplayedSubtext"></p></i>
                            <p><a class="btn btn-danger btn" href="#" role="button" data-bind="click:displayFullAnnouncementText">Read</a></p>
                        </div>

                        <div>


                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Previous Announcements..</h3>
                                </div>
                                <div class="panel-body row">
                                    <div data-bind="foreach: postsLoaded">

                                        <div class="col-md-4">
                                            <a href="#" class="thumbnail">
                                            <img style='width:100%'data-bind="attr:{src: imageURL}, click: $parent.displayPost"  alt="..." class="img-rounded">
                                            </a>
                                        </div>

                                    </div>
                                </div>
                            </div>


                        </div>
                        
                    </div>
                    
                    <div data-bind="if: viewType() == 'Reading'">
                        
                        <div class="panel panel-default" data-bind="with:postBeingDisplayed">
                            
                            <div class="panel-heading">

                                <h2 class="panel-title" >
                                    <button data-bind="click: $parent.displayJumboAnnouncement" type="button" class="btn btn-default btn-sm" aria-label="Left Align">
                                        <span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>
                                    </button>
                                    <span data-bind="text: title"></span>
                                </h2>
                                
                            </div>
                            
                            <div class="panel-body">
                                
                                <img style='width:100%' 
                                    data-bind="attr:{src: imageURL}, 
                                    click: $parent.displayPost"  
                                    alt="..." class="img-rounded"><br/> <br/>
                                
                                <h3 data-bind="text: smallText"></h3>
                                
                                <p data-bind="html: postText" ></p>

                                <br />
                                
                                <h4>Comments:</h4>
                                
                                <div data-bind="html: comments"></div>
                                
                                <a class="btn btn-danger btn" data-bind="attr:{href: postURL}" role="button" >Leave a Comment</a>
                                
                            </div>
                            
                        </div>
                        
                    </div>
                    
                    

                </div>

                <div class="col-md-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Links</h3>
                        </div>
                        <div class="panel-body">
                            Unity download:<br>
                            <a href="https://unity3d.com/get-unity/download?thank-you=update&download_nid=18149&os=Win">https://unity3d.com/get-unity/download?thank-you=update&download_nid=18149&os=Win</a>
                            <br> <br>
                            
                            Github download:<br>
                            <a href="https://desktop.github.com/">https://desktop.github.com/</a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Suggestions?</h3>
                        </div>
                        <div class="panel-body">
                            <i>What would you like to see here? Send us your suggestions! Let your voice be heard!</i>
                            <br><br>Either <a href="javascript:$('#confirm-action').modal()">Contact Us</a>, or take this <a href="http://goo.gl/forms/d7taHkH3uv">anonymous survey</a>.
                        </div>
                    </div>
                </div>

            </div>
            
            

        </div>
        
        <div class="container" data-bind="if:  currentPageView() === 'BaseDiagram'" >
        
            <div class="row">

                <iframe frameborder="0" style="width:100%;height:967px" src="https://www.draw.io/?chrome=0&db=0#G0BwR9imEmcCPgazRTOXpjUmFsVDA"></iframe>

            </div>
            
        </div>

        <script>

            /**
             * Goes to reddit and grabs JSON representing posts made by the
             * reddit user "MSUVGDCAnnouncements" inside of the subreddit
             * msuvgdc.  If it's succesful it will call the cb function with
             * the data it received.
             *
             * @param {type} cb
             * @returns {undefined}
             */
            function getAnnouncementsJson(cb) {
                makeHttpRequest("http://www.reddit.com/r/MSUVGDC/search.json?q=author%3AMSUVGDCAnnouncements&sort=new&restrict_sr=on",null,cb);
            }
            
            /**
             * Loads the comments of a specific post on reddit.
             * 
             * @param {string} post id used for looking up comments of a specific post
             * @param {function} cb The function that is called with the data returned from the request
             * @returns {undefined}
             */
            function getCommentsOfAnnouncementJson(postId, cb){
                makeHttpRequest("https://www.reddit.com/r/MSUVGDC/comments/"+postId+"/.json",null,cb);
            }
            
            /**
             * Reddit comments have alot of junk we don't need for displaying on
             * the page, as well as being nested, we need a recursive function
             * to load in all the comments and build an appropriate JSON object.
             * 
             * @returns {undefined}
             */
            function recursiveBuildComments(rawComments){
        
                var htmlString = "";
                
                
                for(var i = 0; i < rawComments.data.children.length; i ++){
                    htmlString += "<div class='well well-sm'>";
                    htmlString += "<h5>"+ rawComments.data.children[i].data.author +"</h5>";
                    htmlString += rawComments.data.children[i].data.body +"<br/><br/>";
                    console.log(rawComments.data.children[i].data);
                    if(rawComments.data.children[i].data.replies !== ""){
                        
                        htmlString += recursiveBuildComments(rawComments.data.children[i].data.replies);
                    }
                    
                    htmlString +="</div>";
                }
                
                return htmlString;
                
            }
    
            function makeHttpRequest(url, errcb, succb){
                var xmlhttp = new XMLHttpRequest();

                xmlhttp.onreadystatechange = function () {

                    if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {

                        var postData = JSON.parse(xmlhttp.responseText);
                        succb(postData);

                    } else {
                        
                        if(xmlhttp.readyState === 4 && xmlhttp.status !== 200){
                            alert("Failed loading announcements from Reddit!  This\
                                sometimes happens if you're using IE. ");
                
                            if(errcb != null){
                                errcb();
                            }
                            
                        }
                        
                        //cb();
                    }
                };

                xmlhttp.open("GET",
                        url, true);

                xmlhttp.send();
            }

            /**
             *
             * @returns {undefined}
             */
            function AnnouncementsViewModel() {

                var self = this;

                /**
                 * There are three different ways for announcements to be 
                 * displayed, being either Jumbo, Reading, or Side
                 */
                self.viewType = ko.observable("Jumbo");

                /**
                 * To keep this a one page app, we switch the view!
                 */
                self.currentPageView = ko.observable("Front");

                self.postBeingDisplayed = ko.observable();

                self.postsLoaded = ko.observableArray();

                self.displayPost = function(post){
                    self.postBeingDisplayed(post);
                };
                
                self.displayFullAnnouncementText = function(){
                    
                    $('#announcements-panel').addClass('magictime rotateDown');
                    
                    setTimeout(function(){
                        
                        self.viewType("Reading");
                        
                        if(self.postBeingDisplayed().comments() === "None :(<br><br>"){
                            getCommentsOfAnnouncementJson(self.postBeingDisplayed().id, function(data){
                                
                                if(data[1].data.children.length > 0 ){
                                    self.postBeingDisplayed().comments(recursiveBuildComments(data[1]));
                                }
                            });
                        }
                        
                        $('#announcements-panel').removeClass('magictime rotateDown');
                        $('#announcements-panel').addClass('magictime perspectiveDownRetourn');
                        
                        setTimeout(function(){
                            $('#announcements-panel').removeClass('magictime perspectiveDownRetourn');
                        },1000);
                        
                    },1000);
                        
                };
                
                self.displayJumboAnnouncement = function(){
                    $('#announcements-panel').addClass('magictime rotateDown');
                    
                    setTimeout(function(){
                        
                        self.viewType("Jumbo");
                        
                        $('#announcements-panel').removeClass('magictime rotateDown');
                        $('#announcements-panel').addClass('magictime perspectiveDownRetourn');
                        
                        setTimeout(function(){
                            $('#announcements-panel').removeClass('magictime perspectiveDownRetourn');
                        },1000);
                        
                    },1000);
                };
                

                self.postDisplayedTitle = ko.computed(function(){

                    if(self.postBeingDisplayed() != null){
                        return self.postBeingDisplayed().title;
                    }

                    return "Unable to load posts!";

                });

                self.postDisplayedSubtext = ko.computed(function(){

                    if(self.postBeingDisplayed() != null && self.postBeingDisplayed().smallText){
                        return self.postBeingDisplayed().smallText;
                    }

                    return "";
                });


                getAnnouncementsJson(function (data) {

                    if (data == null) {
                        return;
                    }
                    
                    var converter = new showdown.Converter();

                    for (var i = 0; i < data.data.children.length; i++) {

                        var textPost = JSON.parse(data.data.children[i].data.selftext);
                        var post = {
                            "title": data.data.children[i].data.title,
                            "imageURL": textPost.image,
                            "postText": converter.makeHtml(textPost.post),
                            "smallText": textPost.smallText,
                            "id": data.data.children[i].data.id,
                            "comments" : ko.observable("None :(<br><br>"),
                            "postURL" : data.data.children[i].data.url
                        };

                        self.postsLoaded.push(post);

                    }

                    self.postBeingDisplayed(self.postsLoaded()[0]);

                });
                
                self.switchToPlans = function(){
                    self.currentPageView("BaseDiagram");
                };
                
                self.switchToFrontPage = function(){
                    self.currentPageView("Front");
                };

            }

            ko.applyBindings(new AnnouncementsViewModel());

        </script>
        <body>
        
        <!-- Modal -->
        <div class="modal fade" id="confirm-action" role="dialog">
            <div class="modal-dialog">
                
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header" style="padding:15px 30px;">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4><span class="modal-title"></span>Contact Information</h4>
                    </div>
                    <div class="modal-body" style="padding:50px 20px 2px;">
                        <p><strong><span id="custom-Action-Message"></span></strong><div align="center">
                            <b>Eli Davis</b><br>
                            ecd157@msstate.edu<br>
                            <br>
                            <b>Hunter Holder</b><br>
                            hlh229@msstate.edu<br>
                            <br>
                            <!--Other officers you can enter your contact information here-->
                            
                        </div>
                        </p>
                    </div>
<!--                    <div class="modal-footer">
                        <a class="btn btn-warning btn-ok" data-dismiss="modal">Got it!</a>
                    </div>-->
                </div>
                
            </div>
        </div>
        
    </body>
        
    </body>

</html>
